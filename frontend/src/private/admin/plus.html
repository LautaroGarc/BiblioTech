<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Administrador - Gesti√≥n Items | BiblioTech</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/adminPlus_new.css">
</head>

<body>
  
  <script>
    // Cargar el header
    fetch('/components/header.html')
      .then(response => response.text())
      .then(data => {
        document.body.insertAdjacentHTML('afterbegin', data);
      })
      .catch(error => console.error('Error cargando header:', error));
  </script>

  <main id="main-content">
    
    <section class="title-description-section">
      <h1 id="title">Gesti√≥n de Items</h1>
      <p id="descripcion">Administra libros, √∫tiles y procesa pr√©stamos/devoluciones</p>
    </section>
    
    <section class="quick-actions">
      <button class="action-card" onclick="showCreateItemModal()">
        <div class="action-icon">‚ûï</div>
        <div class="action-title">Crear Item</div>
        <div class="action-subtitle">Agregar nuevo libro o √∫til</div>
      </button>

      <button class="action-card" onclick="tramitarPrestamoModal()">
        <div class="action-icon">üì§</div>
        <div class="action-title">Tramitar Pr√©stamo</div>
        <div class="action-subtitle">Entregar item prestado</div>
      </button>

      <button class="action-card" onclick="tramitarDevolucionModal()">
        <div class="action-icon">üì•</div>
        <div class="action-title">Tramitar Devoluci√≥n</div>
        <div class="action-subtitle">Recibir item devuelto</div>
      </button>
    </section>

    <section class="items-management">
      <div class="section-header">
        <h2 class="section-title">üìö Gesti√≥n de Items</h2>
        
        <div class="filters">
          <select id="itemTypeFilter" class="filter-select">
            <option value="all">Todos</option>
            <option value="books">Libros</option>
            <option value="supplies">√ötiles</option>
          </select>
          
          <input type="text" id="itemSearch" class="filter-input" placeholder="Buscar item...">
          
          <button id="refreshItems" class="filter-btn">üîÑ Actualizar</button>
        </div>
      </div>

      <div id="itemsContainer" class="items-container">
        <div class="loading">Cargando items...</div>
      </div>
    </section>

  </main>

  <!-- Modal para crear/editar item -->
  <div id="itemModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeItemModal()">&times;</button>
      
      <h2 id="modalTitle" class="modal-title">Crear Item</h2>

      <!-- Selector de tipo (solo para crear) -->
      <div id="typeSelector" class="type-selector">
        <button class="type-btn" data-type="book" onclick="selectItemType('book')">
          <span class="type-icon">üìö</span>
          <span class="type-label">Libro</span>
        </button>
        <button class="type-btn" data-type="supply" onclick="selectItemType('supply')">
          <span class="type-icon">‚úèÔ∏è</span>
          <span class="type-label">√ötil Escolar</span>
        </button>
      </div>

      <!-- Formulario de libro -->
      <form id="bookForm" class="item-form" style="display: none;">
        <div class="form-group">
          <label>C√≥digo de Barras</label>
          <div class="input-with-button">
            <input type="text" id="bookBarcode" readonly>
            <button type="button" class="scan-btn" onclick="scanForCreate()">üì∑ Escanear</button>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Nombre *</label>
            <input type="text" id="bookName" required>
          </div>
          <div class="form-group">
            <label>Autor *</label>
            <input type="text" id="bookAuthor" required>
          </div>
        </div>

        <div class="form-group">
          <label>Sinopsis *</label>
          <textarea id="bookSinopsis" rows="3" required></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Editorial *</label>
            <input type="text" id="bookEditorial" required>
          </div>
          <div class="form-group">
            <label>G√©nero *</label>
            <input type="text" id="bookGender" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Nivel de Lectura *</label>
            <select id="bookReadLevel" required>
              <option value="">Seleccionar...</option>
              <option value="principiante">Principiante</option>
              <option value="intermedio">Intermedio</option>
              <option value="avanzado">Avanzado</option>
            </select>
          </div>
          <div class="form-group">
            <label>P√°ginas *</label>
            <input type="number" id="bookLength" required min="1">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Tema *</label>
            <input type="text" id="bookTheme" required>
          </div>
          <div class="form-group">
            <label>Cantidad *</label>
            <input type="number" id="bookQuant" required min="1" value="1">
          </div>
        </div>

        <div class="form-group">
          <label>URL de Imagen</label>
          <input type="url" id="bookImg" placeholder="https://...">
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Guardar Libro</button>
          <button type="button" class="btn btn-secondary" onclick="closeItemModal()">Cancelar</button>
        </div>
      </form>

      <!-- Formulario de √∫til -->
      <form id="supplyForm" class="item-form" style="display: none;">
        <div class="form-group">
          <label>C√≥digo de Barras</label>
          <div class="input-with-button">
            <input type="text" id="supplyBarcode" readonly>
            <button type="button" class="scan-btn" onclick="scanForCreate()">üì∑ Escanear</button>
          </div>
        </div>

        <div class="form-group">
          <label>Nombre *</label>
          <input type="text" id="supplyName" required>
        </div>

        <div class="form-group">
          <label>Cantidad Total *</label>
          <input type="number" id="supplyQuantity" required min="1" value="1">
        </div>

        <div class="form-group">
          <label>URL de Imagen</label>
          <input type="url" id="supplyImg" placeholder="https://...">
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Guardar √ötil</button>
          <button type="button" class="btn btn-secondary" onclick="closeItemModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Incluir componente de c√≥digo de barras -->
  <div id="barcodeContainer"></div>

  <!-- Modal para tramitar pr√©stamo -->
  <div id="loanModal" class="modal">
    <div class="modal-content">
      <h2>Tramitar Pr√©stamo</h2>
      <form onsubmit="return false;">
        <div class="form-group">
          <label>Email del Usuario *</label>
          <input type="email" id="loanUserEmail" placeholder="usuario@ejemplo.com" required>
        </div>
        <div class="form-group">
          <label>Tipo de Item *</label>
          <select id="loanItemType" onchange="loadItemsForLoan()">
            <option value="">Seleccionar...</option>
            <option value="libro">Libro</option>
            <option value="utiles">√ötil Escolar</option>
          </select>
        </div>
        <div class="form-group">
          <label>Item *</label>
          <select id="loanItemId">
            <option value="">Selecciona tipo primero...</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-primary" onclick="processTramitarPrestamo()">Tramitar Pr√©stamo</button>
          <button type="button" class="btn btn-secondary" onclick="closeLoanModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para tramitar devoluci√≥n -->
  <div id="returnModal" class="modal">
    <div class="modal-content">
      <h2>Tramitar Devoluci√≥n</h2>
      <form onsubmit="return false;">
        <div class="form-group">
          <label>Buscar Pr√©stamo</label>
          <input type="text" id="returnSearchInput" placeholder="Buscar por usuario o item..." oninput="filterActiveLoans()">
        </div>
        <div class="form-group">
          <label>Pr√©stamos Activos</label>
          <select id="returnLoanId" size="8" style="width: 100%; height: 300px;">
            <option value="">Cargando pr√©stamos activos...</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-primary" onclick="processTramitarDevolucion()">Tramitar Devoluci√≥n</button>
          <button type="button" class="btn btn-secondary" onclick="closeReturnModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Cargar barra de navegaci√≥n -->
  <div id="nav-placeholder"></div>

  <script src="/js/adminPlus.js"></script>
  <script>
    // Cargar la barra de navegaci√≥n
    fetch('/components/navigation.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('nav-placeholder').innerHTML = data;
      })
      .catch(error => console.error('Error cargando navegaci√≥n:', error));

    // Cargar componente de c√≥digo de barras
    fetch('/components/barCode.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('barcodeContainer').innerHTML = html;
      });
  </script>
</body>
</html>
