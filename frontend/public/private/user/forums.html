<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foros de Lectura</title>
    <link rel="stylesheet" href="styles/forums.css">
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">ğŸ“š</div>
            <h1>Foros de Lectura</h1>
        </div>
        <div class="header-actions">
            <a href="ranking.html" class="header-btn">
                <span>ğŸ†</span> Ranking
            </a>
            <a href="perfil.html" class="header-btn">
                <span>ğŸ‘¤</span> Mi Perfil
            </a>
        </div>
    </header>

    <div class="principal">
        <div class="page-title">
            <h1>Â¡NUESTROS FOROS!</h1>
            <p>Participa en nuestra comunidad de lectores.</p>
        </div>

        <div class="forums-container">
            <div class="forums-list">
                <h2><span>ğŸ“‚</span> Foros Disponibles</h2>
                <div id="forums">
                    <!-- Los foros se cargarÃ¡n aquÃ­ con JavaScript -->
                </div>
            </div>

            <div class="chat-container">
                <div class="chat-header">
                    <h2 id="current-forum-title">Selecciona un foro</h2>
                    <p id="current-forum-desc">Haz clic en un foro para ver sus conversaciones</p>
                </div>
                
                <div class="chat-messages" id="forum-chat">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ’¬</div>
                        <h3>No hay foro seleccionado</h3>
                        <p>Selecciona un foro de la lista para ver sus mensajes</p>
                    </div>
                </div>
                
                <div class="comment-form">
                    <div id="reply-indicator" class="reply-indicator" style="display: none;">
                        <div class="reply-info">
                            <span>â†©ï¸</span>
                            <span>Respondiendo a <strong id="reply-to-user">Usuario</strong></span>
                        </div>
                        <button id="cancel-reply" class="reply-cancel">âœ•</button>
                    </div>
                    
                    <form id="comment-form">
                        <textarea id="comment" name="comment" rows="3" placeholder="Escribe tu comentario..." maxlength="500"></textarea>
                        <div class="form-actions">
                            <div class="char-counter">
                                <span id="char-count">0</span>/500 caracteres
                            </div>
                            <button type="submit" class="submit-btn" id="submit-btn" disabled>
                                <span>ğŸ“¤</span> Enviar Comentario
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="pagination">
            <button id="prevPageBtn" disabled>
                <span>â—€</span> Anterior
            </button>
            <span class="page-info" id="pageInfo">PÃ¡gina 1 de 3</span>
            <button id="nextPageBtn">
                Siguiente <span>â–¶</span>
            </button>
        </div>
    </div>

    <script>
        // Datos de ejemplo para los foros
        const forumsData = [
            {
                id: 1,
                title: "Recomendaciones de Libros",
                description: "Comparte tus libros favoritos y descubre nuevas lecturas",
                icon: "ğŸ“š",
                messages: [
                    {
                        id: 101,
                        user: "MarÃ­a GonzÃ¡lez",
                        avatar: "MG",
                        text: "Â¿Alguien ha leÃ­do 'Cien aÃ±os de soledad'? Â¡Es una obra maestra!",
                        time: "10:30 AM",
                        likes: 5,
                        replies: [
                            {
                                id: 201,
                                user: "Carlos LÃ³pez",
                                avatar: "CL",
                                text: "SÃ­, es increÃ­ble. Me encantÃ³ cÃ³mo GarcÃ­a MÃ¡rquez mezcla realidad y fantasÃ­a.",
                                time: "11:15 AM",
                                likes: 3
                            }
                        ]
                    },
                    {
                        id: 102,
                        user: "Ana MartÃ­nez",
                        avatar: "AM",
                        text: "Estoy buscando libros de ciencia ficciÃ³n. Â¿Recomendaciones?",
                        time: "09:45 AM",
                        likes: 2,
                        replies: []
                    }
                ]
            },
            {
                id: 2,
                title: "Club de Lectura",
                description: "Discute el libro del mes con otros lectores",
                icon: "ğŸ‘¥",
                messages: [
                    {
                        id: 103,
                        user: "Pedro SÃ¡nchez",
                        avatar: "PS",
                        text: "Este mes estamos leyendo 'El amor en los tiempos del cÃ³lera'. Â¿QuÃ© opinan?",
                        time: "Ayer, 4:20 PM",
                        likes: 7,
                        replies: [
                            {
                                id: 202,
                                user: "Laura Ruiz",
                                avatar: "LR",
                                text: "Me estÃ¡ gustando mucho, aunque el ritmo es un poco lento al principio.",
                                time: "Ayer, 5:45 PM",
                                likes: 2
                            },
                            {
                                id: 203,
                                user: "Roberto DÃ­az",
                                avatar: "RD",
                                text: "Es mi primer libro de GarcÃ­a MÃ¡rquez y me estÃ¡ encantando su prosa.",
                                time: "Hoy, 9:15 AM",
                                likes: 1
                            }
                        ]
                    }
                ]
            },
            {
                id: 3,
                title: "Novedades Literarias",
                description: "Mantente al dÃ­a con los Ãºltimos lanzamientos",
                icon: "ğŸ†•",
                messages: [
                    {
                        id: 104,
                        user: "Editorial Luna",
                        avatar: "EL",
                        text: "Acaba de salir 'La ciudad de los espejos', la nueva novela de Carlos Ruiz ZafÃ³n",
                        time: "2 dÃ­as atrÃ¡s",
                        likes: 12,
                        replies: []
                    }
                ]
            },
            {
                id: 4,
                title: "Escritores Principiantes",
                description: "Comparte tus escritos y recibe feedback",
                icon: "âœï¸",
                messages: [
                    {
                        id: 105,
                        user: "SofÃ­a Torres",
                        avatar: "ST",
                        text: "Estoy escribiendo mi primera novela y me gustarÃ­a compartir el primer capÃ­tulo para recibir opiniones.",
                        time: "3 dÃ­as atrÃ¡s",
                        likes: 4,
                        replies: []
                    }
                ]
            },
            {
                id: 5,
                title: "ClÃ¡sicos de la Literatura",
                description: "Debate sobre las obras que marcaron la historia",
                icon: "ğŸ›ï¸",
                messages: [
                    {
                        id: 106,
                        user: "Miguel Ãngel",
                        avatar: "MA",
                        text: "Â¿CuÃ¡l consideran que es la obra mÃ¡s importante de Shakespeare?",
                        time: "1 semana atrÃ¡s",
                        likes: 8,
                        replies: [
                            {
                                id: 204,
                                user: "Elena Vargas",
                                avatar: "EV",
                                text: "Para mÃ­, 'Hamlet' es insuperable. La profundidad psicolÃ³gica del personaje es asombrosa.",
                                time: "6 dÃ­as atrÃ¡s",
                                likes: 5
                            }
                        ]
                    }
                ]
            }
        ];

        // Estado de la aplicaciÃ³n
        let currentForumId = null;
        let currentPage = 1;
        const messagesPerPage = 5;
        let replyingTo = null;

        // Elementos del DOM
        const forumsContainer = document.getElementById('forums');
        const forumChat = document.getElementById('forum-chat');
        const currentForumTitle = document.getElementById('current-forum-title');
        const currentForumDesc = document.getElementById('current-forum-desc');
        const commentForm = document.getElementById('comment-form');
        const commentInput = document.getElementById('comment');
        const submitBtn = document.getElementById('submit-btn');
        const charCount = document.getElementById('char-count');
        const replyIndicator = document.getElementById('reply-indicator');
        const replyToUser = document.getElementById('reply-to-user');
        const cancelReplyBtn = document.getElementById('cancel-reply');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const pageInfo = document.getElementById('pageInfo');

        // Inicializar la aplicaciÃ³n
        document.addEventListener('DOMContentLoaded', function() {
            renderForums();
            setupEventListeners();
        });

        // Renderizar la lista de foros
        function renderForums() {
            forumsContainer.innerHTML = '';
            
            forumsData.forEach(forum => {
                const totalMessages = forum.messages.reduce((total, msg) => 
                    total + 1 + msg.replies.length, 0);
                
                const forumElement = document.createElement('div');
                forumElement.className = 'forum-item';
                forumElement.innerHTML = `
                    <div class="forum-icon">${forum.icon}</div>
                    <div class="forum-content">
                        <h3>${forum.title}</h3>
                        <p>${forum.description}</p>
                        <div class="forum-stats">
                            <span>ğŸ’¬ ${totalMessages} mensajes</span>
                            <span>ğŸ‘¥ ${getRandomInt(50, 500)} miembros</span>
                        </div>
                    </div>
                `;
                
                forumElement.addEventListener('click', () => selectForum(forum.id));
                forumsContainer.appendChild(forumElement);
            });
        }

        // Seleccionar un foro
        function selectForum(forumId) {
            currentForumId = forumId;
            currentPage = 1;
            
            // Actualizar estilos de los foros
            document.querySelectorAll('.forum-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelectorAll('.forum-item')[forumId - 1].classList.add('active');
            
            // Actualizar informaciÃ³n del foro seleccionado
            const forum = forumsData.find(f => f.id === forumId);
            currentForumTitle.textContent = forum.title;
            currentForumDesc.textContent = forum.description;
            
            // Renderizar mensajes
            renderMessages();
            
            // Habilitar el formulario
            submitBtn.disabled = false;
            
            // Actualizar paginaciÃ³n
            updatePagination();
        }

        // Renderizar mensajes del foro actual
        function renderMessages() {
            if (!currentForumId) return;
            
            const forum = forumsData.find(f => f.id === currentForumId);
            if (!forum) return;
            
            // Calcular quÃ© mensajes mostrar segÃºn la pÃ¡gina actual
            const allMessages = getAllMessages(forum);
            const startIndex = (currentPage - 1) * messagesPerPage;
            const endIndex = startIndex + messagesPerPage;
            const messagesToShow = allMessages.slice(startIndex, endIndex);
            
            forumChat.innerHTML = '';
            
            if (messagesToShow.length === 0) {
                forumChat.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ’¬</div>
                        <h3>No hay mensajes</h3>
                        <p>SÃ© el primero en comentar en este foro</p>
                    </div>
                `;
                return;
            }
            
            messagesToShow.forEach(msgData => {
                const messageElement = createMessageElement(msgData);
                forumChat.appendChild(messageElement);
            });
        }

        // Obtener todos los mensajes (incluyendo respuestas) como una lista plana
        function getAllMessages(forum) {
            const allMessages = [];
            
            forum.messages.forEach(msg => {
                // Agregar el mensaje principal
                allMessages.push({
                    ...msg,
                    isReply: false,
                    parentId: null
                });
                
                // Agregar las respuestas
                msg.replies.forEach(reply => {
                    allMessages.push({
                        ...reply,
                        isReply: true,
                        parentId: msg.id
                    });
                });
            });
            
            return allMessages;
        }

        // Crear elemento HTML para un mensaje
        function createMessageElement(msgData) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${msgData.isReply ? 'reply' : ''} fade-in`;
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${msgData.avatar}</div>
                <div class="message-content">
                    <div class="message-user">${msgData.user}</div>
                    <div class="message-text">${msgData.text}</div>
                    <div class="message-time">${msgData.time}</div>
                    <div class="message-actions">
                        <button class="message-action like-btn" data-id="${msgData.id}">
                            <span>ğŸ‘</span> ${msgData.likes}
                        </button>
                        <button class="message-action reply-btn" data-id="${msgData.id}" data-user="${msgData.user}">
                            <span>â†©ï¸</span> Responder
                        </button>
                    </div>
                </div>
            `;
            
            return messageDiv;
        }

        // Configurar event listeners
        function setupEventListeners() {
            // EnvÃ­o del formulario de comentarios
            commentForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const commentText = commentInput.value.trim();
                
                if (commentText && currentForumId) {
                    addComment(commentText);
                    commentInput.value = '';
                    charCount.textContent = '0';
                    submitBtn.disabled = true;
                    
                    // Si estÃ¡bamos respondiendo, cancelar el modo respuesta
                    if (replyingTo) {
                        cancelReply();
                    }
                }
            });
            
            // Contador de caracteres
            commentInput.addEventListener('input', function() {
                const length = this.value.length;
                charCount.textContent = length;
                submitBtn.disabled = length === 0 || length > 500;
            });
            
            // Cancelar respuesta
            cancelReplyBtn.addEventListener('click', cancelReply);
            
            // PaginaciÃ³n
            prevPageBtn.addEventListener('click', goToPrevPage);
            nextPageBtn.addEventListener('click', goToNextPage);
            
            // DelegaciÃ³n de eventos para los botones de like y reply
            forumChat.addEventListener('click', function(e) {
                if (e.target.closest('.like-btn')) {
                    const button = e.target.closest('.like-btn');
                    const messageId = parseInt(button.dataset.id);
                    likeMessage(messageId);
                }
                
                if (e.target.closest('.reply-btn')) {
                    const button = e.target.closest('.reply-btn');
                    const messageId = parseInt(button.dataset.id);
                    const userName = button.dataset.user;
                    setReplyMode(messageId, userName);
                }
            });
        }

        // Agregar un nuevo comentario
        function addComment(text) {
            if (!currentForumId) return;
            
            const forum = forumsData.find(f => f.id === currentForumId);
            if (!forum) return;
            
            const newMessage = {
                id: Date.now(), // ID Ãºnico basado en timestamp
                user: "TÃº", // En una app real, esto vendrÃ­a del usuario autenticado
                avatar: "TÃš",
                text: text,
                time: "Ahora",
                likes: 0,
                replies: []
            };
            
            if (replyingTo) {
                // Buscar el mensaje al que se estÃ¡ respondiendo y agregar la respuesta
                const parentMessage = forum.messages.find(msg => 
                    msg.id === replyingTo || msg.replies.some(reply => reply.id === replyingTo)
                );
                
                if (parentMessage) {
                    parentMessage.replies.push(newMessage);
                }
            } else {
                // Agregar como nuevo mensaje principal
                forum.messages.unshift(newMessage);
            }
            
            // Volver a renderizar los mensajes
            renderMessages();
        }

        // Dar like a un mensaje
        function likeMessage(messageId) {
            if (!currentForumId) return;
            
            const forum = forumsData.find(f => f.id === currentForumId);
            if (!forum) return;
            
            // Buscar el mensaje en los mensajes principales
            let message = forum.messages.find(msg => msg.id === messageId);
            
            // Si no se encuentra, buscar en las respuestas
            if (!message) {
                for (const mainMsg of forum.messages) {
                    message = mainMsg.replies.find(reply => reply.id === messageId);
                    if (message) break;
                }
            }
            
            if (message) {
                message.likes++;
                renderMessages();
            }
        }

        // Establecer modo de respuesta
        function setReplyMode(messageId, userName) {
            replyingTo = messageId;
            replyToUser.textContent = userName;
            replyIndicator.style.display = 'flex';
            commentInput.focus();
        }

        // Cancelar modo de respuesta
        function cancelReply() {
            replyingTo = null;
            replyIndicator.style.display = 'none';
        }

        // Navegar a la pÃ¡gina anterior
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderMessages();
                updatePagination();
            }
        }

        // Navegar a la pÃ¡gina siguiente
        function goToNextPage() {
            if (!currentForumId) return;
            
            const forum = forumsData.find(f => f.id === currentForumId);
            if (!forum) return;
            
            const allMessages = getAllMessages(forum);
            const totalPages = Math.ceil(allMessages.length / messagesPerPage);
            
            if (currentPage < totalPages) {
                currentPage++;
                renderMessages();
                updatePagination();
            }
        }

        // Actualizar estado de la paginaciÃ³n
        function updatePagination() {
            if (!currentForumId) {
                prevPageBtn.disabled = true;
                nextPageBtn.disabled = true;
                pageInfo.textContent = "PÃ¡gina 1 de 1";
                return;
            }
            
            const forum = forumsData.find(f => f.id === currentForumId);
            if (!forum) return;
            
            const allMessages = getAllMessages(forum);
            const totalPages = Math.ceil(allMessages.length / messagesPerPage);
            
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            pageInfo.textContent = `PÃ¡gina ${currentPage} de ${totalPages}`;
        }

        // FunciÃ³n auxiliar para nÃºmeros aleatorios
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
    </script>
</body>
</html>